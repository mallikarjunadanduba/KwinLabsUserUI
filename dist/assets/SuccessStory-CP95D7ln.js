import{a as h,B as d,u as ee,r as c,j as e,M as se,d as E,c as x,G as y,g as te,P as ae,I as F,T as S}from"./index-Dg2GFtxE.js";import{h as $}from"./moment-G82_0lEo.js";import{d as re,D as oe}from"./Add-DhjQQOyT.js";import{d as ne}from"./Edit-DHjvWgvb.js";import{d as ce}from"./DeleteForever-BeZhJ2IL.js";import{T as ie,a as le,b as de,c as k,d as A,e as ue,f as he}from"./TableRow-tis0D7HP.js";import{D as me,a as pe}from"./DialogTitle-CHS1QA2F.js";import"./LastPage-DdfZQxWB.js";import"./MenuItem-DouCongq.js";const ge=async o=>await h({method:"get",url:`${d}/success/v1/getAllSuccessStoryByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:o}),ye=async(o,l)=>await h({method:"GET",url:`${d}/success/v1/getSuccessStoryById/{successstoryId}?successstoryId=${o}`,headers:l}),fe=async(o,l)=>(console.log(o),await h({method:"PUT",url:`${d}/success/v1/updateSuccessStory`,headers:l,data:o}).then(function(t){console.log(t),t.data.responseCode===201?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(function(t){console.log(t)})),xe=async(o,l)=>await h({method:"delete",url:`${d}/success/v1/deleteSuccessStoryById/${o}`,headers:l}).then(t=>{t.data.responseCode===200?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(t=>{console.log(t)}),Se=async(o,l)=>{try{return await h({method:"POST",url:`${d}/success/v1/createSuccessStory`,headers:l,data:o}).then(function(t){console.log(t),t.data.responseCode===201?alert("Advertisement  added successfully"):t.data.responseCode===400&&alert(t.data.errorMessage)})}catch(t){alert(t)}},U=[{id:"successstoryId",label:"ID"},{id:"successstoryName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ee=()=>{ee();const[o,l]=c.useState(0),[t,W]=c.useState(10),[N,j]=c.useState([]),[b,w]=c.useState(!1),[M,m]=c.useState(!1),[R,z]=c.useState(null),[Ne,I]=c.useState(""),[u,D]=c.useState({}),[C,O]=c.useState(null),P=c.useRef(null),[je,v]=c.useState(""),[G,B]=c.useState(!1),[i,p]=c.useState({successstoryName:"",description:""}),H=(s,a)=>{l(a)},_=s=>{W(+s.target.value),l(0)},f=JSON.parse(sessionStorage.getItem("user")),g={"Content-type":"application/json",Authorization:`Bearer ${f.accessToken}`},L=`${d}/file/downloadFile/?filePath=`,J=async()=>{try{const a=(await ge(g)).data.content;if(a){const r=a.map(n=>({successstoryId:n.successstoryId,successstoryName:n.successstoryName,description:n.description,file:n.photoPath?e.jsx("img",{src:L+n.photoPath,alt:n.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:$(n.insertedDate).format("L"),updatedDate:$(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));j(r)}else j([])}catch(s){console.error("Error fetching data:",s)}};c.useEffect(()=>{J()},[G]);const V=()=>{const s={};return i.successstoryName.trim()||(s.successstoryName="Enter the News"),i.description.trim()||(s.description="Enter the Description"),(!i.photoName||i.photoName.trim()==="")&&(s.photoName="Select the file"),s},T=s=>{p({...i,[s.target.name]:s.target.value}),D(a=>({...a,[s.target.name]:null}))},q=async s=>{try{await xe(s,g),B(a=>!a)}catch(a){console.error("Error deleting news:",a)}},K=async s=>{w(!0),m(!0);try{const r=(await ye(s,g)).data;z(r.successstoryId),p({successstoryName:r.successstoryName,description:r.description,photoName:r.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},Q=async s=>{if(s.preventDefault(),!C){v("Please select a file");return}const a=new FormData;a.append("file",C);try{const r=await h.post(`${d}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${f.accessToken}`}});I(r.data.fileName),p(n=>({...n,photoName:r.data.fileName})),v(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},X=s=>{I(s.target.files[0].name),O(s.target.files[0])},Y=async s=>{s.preventDefault();const a=V();if(console.log(i),Object.keys(a).length>0)D(a);else try{if(b){const r={...i,successstoryId:R,updatedBy:{userId:f.userId}};await fe(r,g)}else{const r={...i,createdBy:{userId:f.userId}};await Se(r,g)}p({successstoryName:"",description:"",photoName:""}),P.current.value=null,B(r=>!r),m(!1)}catch(r){console.error("Error saving news:",r)}},Z=()=>{w(!1),p({successstoryName:"",description:"",photoName:""}),m(!0)};return e.jsxs(se,{title:e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(x,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Z,children:["Add",e.jsx(re,{sx:{color:"#fff"}})]})]}),children:[e.jsx(y,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ie,{sx:{maxHeight:440},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(de,{children:e.jsx(k,{children:U.map(s=>e.jsx(A,{align:s.align,style:{minWidth:s.minWidth,fontWeight:600,fontSize:15},children:s.label},s.id))})}),e.jsx(ue,{children:N.slice(o*t,o*t+t).map(s=>e.jsx(k,{hover:!0,role:"checkbox",tabIndex:-1,children:U.map(a=>e.jsx(A,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>K(s.successstoryId),color:"primary",children:e.jsx(ne,{})}),e.jsx(F,{onClick:()=>q(s.successstoryId),color:"error",children:e.jsx(ce,{})})]}):s[a.id]},a.id))},s.successstoryId))})]})}),e.jsx(he,{rowsPerPageOptions:[10,25,100],component:"div",count:N.length,rowsPerPage:t,page:o,onPageChange:H,onRowsPerPageChange:_})]}),e.jsxs(me,{open:M,onClose:()=>m(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(pe,{sx:{fontSize:"16px"},children:b?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(E,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:i.successstoryName,onChange:T,error:!!u.successstoryName,helperText:u.successstoryName})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:T,error:!!u.description,helperText:u.description,multiline:!0,rows:3})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(S,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:i.photoName,disabled:!0,helperText:u.photoName,error:!!u.photoName,InputProps:{endAdornment:e.jsx(x,{variant:"contained",color:"primary",onClick:Q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:P,style:{marginTop:20}})]})]}),e.jsxs(oe,{children:[e.jsx(x,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Ee as default};
