import{e as $,i as I,j as e,b as l,f as i,r as d,aG as P,ap as T,aV as V,P as R,aD as q,I as B,T as k}from"./index-Dg2GFtxE.js";import{T as L}from"./Tooltip-P6IMwWQB.js";var _={},G=I;Object.defineProperty(_,"__esModule",{value:!0});var F=_.default=void 0,J=G($()),N=e;F=_.default=(0,J.default)((0,N.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var A={},X=I;Object.defineProperty(A,"__esModule",{value:!0});var W=A.default=void 0,Q=X($()),Y=e;W=A.default=(0,Q.default)((0,Y.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile");var D={},Z=I;Object.defineProperty(D,"__esModule",{value:!0});var E=D.default=void 0,ee=Z($()),te=e;E=D.default=(0,ee.default)((0,te.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");const re=({text:m})=>{if(!m)return null;const u=m.split(/```/);return e.jsx(l,{sx:{p:1},children:u.map((n,s)=>s%2!==0?e.jsx(l,{component:"pre",sx:{bgcolor:"#f5f5f5",p:1.5,borderRadius:1,overflowX:"auto",fontFamily:"monospace",mb:2,fontSize:"14px",lineHeight:1.4},children:n.trim()},`code-${s}`):n.replace(/\*/g,"").replace(/([a-dA-D])\)/g,"$1) ").split(`
`).map(r=>r.trim()).filter(Boolean).map((r,c)=>/^\d+\.\s/.test(r)?e.jsx(l,{sx:{mb:1.5},children:e.jsx(i,{variant:"body2",sx:{fontWeight:500,lineHeight:1.6,color:"#1a1a1a"},children:r})},`num-${s}-${c}`):/^[a-dA-D][\.\)]\s/.test(r)?e.jsx(i,{variant:"body2",sx:{ml:3,mb:.5,lineHeight:1.5,color:"#333"},children:r},`opt-${s}-${c}`):/^[-â€¢]\s/.test(r)?e.jsx(i,{variant:"body2",sx:{ml:2,mb:.5,lineHeight:1.5,color:"#333"},children:r.replace(/^[-â€¢]\s/,"â€¢ ")},`bullet-${s}-${c}`):r.endsWith(":")&&r.length<50?e.jsx(i,{variant:"body1",sx:{fontWeight:600,mt:2,mb:1,color:"#1a1a1a",lineHeight:1.4},children:r},`heading-${s}-${c}`):r.length>0?e.jsx(i,{variant:"body2",sx:{mb:1.5,lineHeight:1.6,color:"#333",textAlign:"justify"},children:r},`p-${s}-${c}`):null))})},ne=()=>{const[m,u]=d.useState([{from:"bot",text:"Hi! I am your Kwinlabs Agent. How can I help you today?"}]),[n,s]=d.useState(""),[a,j]=d.useState(null),[r,c]=d.useState(!1),M=d.useRef(null),y=d.useRef(""),g=d.useRef(null);d.useEffect(()=>{var t;(t=M.current)==null||t.scrollIntoView({behavior:"smooth"})},[m]);const H=async()=>{if(!n.trim()&&!a)return;const t=a?{from:"user",text:`ðŸ“Ž ${a.name}`,fileUrl:URL.createObjectURL(a)}:{from:"user",text:n};u(o=>[...o,t]),s(""),c(!0);const h={from:"bot",text:""};u(o=>[...o,h]),y.current="";let z=null;try{let o;if(a){const p=new FormData;n&&p.append("message",n),a&&p.append("file",a),o=await fetch("http://localhost:8070/ws/ai/chat-stream-file",{method:"POST",body:p})}else o=await fetch("http://localhost:8070/ws/ai/chat-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})});if(!o.ok||!o.body)throw new Error("Failed to connect to SSE endpoint");const x=o.body.getReader(),b=new TextDecoder("utf-8");let w="";for(z=setInterval(()=>{u(p=>{const v=[...p],f=v[v.length-1];return f.from==="bot"&&(f.text=y.current),[...v.slice(0,-1),f]})},50);;){const{value:p,done:v}=await x.read();if(v)break;w+=b.decode(p,{stream:!0});const f=w.split(`
`);for(let S=0;S<f.length-1;S++){const C=f[S].trim();if(C.startsWith("data:")){const U=C.replace(/^data:\s*/,"");y.current+=U}}w=f[f.length-1]}}catch(o){console.error(o),u(x=>[...x,{from:"bot",text:"Something went wrong. Please try again."}])}finally{clearInterval(z),u(o=>{const x=[...o],b=x[x.length-1];return b.from==="bot"&&(b.text=y.current),[...x.slice(0,-1),b]}),c(!1),j(null),g.current&&(g.current.value=null)}},K=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),H())},O=t=>{const h=t.target.files[0];h&&(j(h),t.target.value=null)};return e.jsxs(l,{sx:{height:"100%",display:"flex",flexDirection:"column",bgcolor:"#ffffff",position:"relative"},children:[e.jsx(l,{sx:{position:"fixed",top:0,left:0,right:0,zIndex:1e3,borderBottom:"1px solid #e5e5e5",bgcolor:"#ffffff",py:2,px:3},children:e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#1a1a1a",textAlign:"center"},children:"Kwinlabs AI Agent"})}),e.jsx(l,{sx:{flex:1,overflow:"auto",bgcolor:"#ffffff",mt:"64px",mb:"200px"},children:e.jsxs(P,{maxWidth:"md",sx:{py:2},children:[m.map((t,h)=>e.jsxs(l,{sx:{display:"flex",justifyContent:t.from==="user"?"flex-end":"flex-start",mb:3,gap:2},children:[t.from==="bot"&&e.jsx(T,{sx:{width:32,height:32,bgcolor:"#10a37f",mt:.5},children:e.jsx(V,{size:16,color:"white"})}),e.jsx(l,{sx:{maxWidth:"80%",minWidth:"200px"},children:t.from==="bot"?e.jsx(R,{elevation:0,sx:{bgcolor:"#f7f7f8",borderRadius:"12px",p:2,border:"1px solid #e5e5e5"},children:e.jsx(re,{text:t.text})}):e.jsx(R,{elevation:0,sx:{bgcolor:"#10a37f",borderRadius:"12px",p:2,color:"white"},children:t.fileUrl?e.jsx(i,{component:"a",href:t.fileUrl,download:!0,target:"_blank",rel:"noopener noreferrer",sx:{color:"white",textDecoration:"underline","&:hover":{color:"#e0e0e0"}},children:t.text}):e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-wrap",lineHeight:1.5},children:t.text})})}),t.from==="user"&&e.jsx(T,{sx:{width:32,height:32,bgcolor:"#10a37f",mt:.5},children:e.jsx(E,{fontSize:"small"})})]},h)),e.jsx("div",{ref:M})]})}),e.jsx(l,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:1e3,borderTop:"1px solid #e5e5e5",bgcolor:"#ffffff",p:3},children:e.jsxs(P,{maxWidth:"md",children:[a&&e.jsx(l,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:e.jsx(q,{label:a.name,onDelete:()=>{j(null),g.current&&(g.current.value=null)},color:"primary",variant:"outlined",size:"small"})}),e.jsxs(R,{component:"form",elevation:0,sx:{display:"flex",alignItems:"flex-end",border:"1px solid #e5e5e5",borderRadius:"12px",p:1,bgcolor:"#ffffff","&:focus-within":{borderColor:"#10a37f",boxShadow:"0 0 0 2px rgba(16, 163, 127, 0.1)"}},onSubmit:t=>{t.preventDefault(),H()},children:[e.jsx(L,{title:"Attach a file",children:e.jsxs(B,{component:"label",sx:{p:1,color:"#666","&:hover":{color:"#10a37f"}},children:[e.jsx(W,{fontSize:"small"}),e.jsx("input",{ref:g,type:"file",hidden:!0,onChange:O})]})}),e.jsx(k,{fullWidth:!0,multiline:!0,maxRows:4,variant:"standard",placeholder:"Message Kwinlabs AI Agent...",value:n,onChange:t=>s(t.target.value),onKeyDown:K,InputProps:{disableUnderline:!0,style:{padding:"8px 12px",fontSize:"16px",lineHeight:1.5}},disabled:r,sx:{"& .MuiInputBase-root":{minHeight:"44px"}}}),e.jsx(B,{color:"primary",type:"submit",disabled:r||!n.trim()&&!a,sx:{p:1,color:!n.trim()&&!a?"#ccc":"#10a37f","&:hover":{bgcolor:"rgba(16, 163, 127, 0.1)"}},children:e.jsx(F,{fontSize:"small"})})]}),e.jsx(i,{variant:"caption",sx:{mt:1,textAlign:"center",color:"#666",display:"block"},children:"Kwinlabs AI Agent can make mistakes. Consider checking important information."})]})})]})};export{ne as default};
